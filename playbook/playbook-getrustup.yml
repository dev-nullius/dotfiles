---
- name: Configure Rust Environment
  hosts: localhost
  become: false
  tasks:
    - name: Create temporary directory
      ansible.builtin.tempfile:
        state: directory
        suffix: ansible
      register: tmpdir
      check_mode: false

    - name: Download rustup Installer
      ansible.builtin.get_url:
        url: "https://raw.githubusercontent.com/rust-lang/rustup/master/rustup-init.sh"
        dest: "{{ tmpdir.path }}"
        mode: 0700
        checksum: "sha256:be3535b3033ff5e0ecc4d589a35d3656f681332f860c5fd6684859970165ddcc"

    - name: Install Rust Installer
      ansible.builtin.shell: >
        ./rustup-init.sh -y --no-modify-path
      args:
        creates: "{{ ansible_env.HOME }}/.rustup/settings.toml"
        chdir: "{{ tmpdir.path }}"
        executable: /bin/sh
